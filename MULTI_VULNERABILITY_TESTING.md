# Multi-Vulnerability Testing Guide

## âœ… Implementation Summary

### What Was Fixed

#### 1. **Multi-Vulnerability Support** âœ…
- âœ… Backend already stores vulnerabilities as array (Machine.vulnerabilities)
- âœ… Each vulnerability has its own moduleId, flag, points, difficulty
- âœ… Flag verification checks against ALL vulnerabilities in the array
- âœ… No overwriting of previously solved vulnerabilities

#### 2. **Per-Vulnerability Interface** âœ…
- âœ… Vulnerability selector shows ALL vulnerabilities as clickable tabs
- âœ… Each vulnerability can be selected and solved independently
- âœ… Visual indicators show which vulnerability is active
- âœ… Solved vulnerabilities display checkmark (âœ“) in selector

#### 3. **Persistent Solved State** âœ…
- âœ… User.solvedVulnerabilities stores each solved vulnerability with machineId and moduleId
- âœ… Machine marked as solved ONLY when ALL flags are captured
- âœ… solvedVulns state persists across page reloads (fetched from backend)
- âœ… Lab completion banner shows when all vulnerabilities solved

#### 4. **Solution/Walkthrough View** âœ…
- âœ… "Show Solutions" button appears when lab fully solved
- âœ… Solutions display for each solved vulnerability
- âœ… Each solution includes: Objective, Steps, Key Concepts, Flag
- âœ… Solutions cover all 18 vulnerability types

---

## ğŸ§ª Testing Scenarios

### Test 1: Single Vulnerability Machine

**Setup:**
1. Create a machine with 1 vulnerability (e.g., SQL Injection)
2. Deploy and open the lab

**Expected Behavior:**
- âœ… No vulnerability selector shown (only 1 vuln)
- âœ… Can submit flag directly
- âœ… After solving, lab marked as solved
- âœ… "Show Solutions" button appears
- âœ… Solution displays walkthrough for SQL Injection

**Test Commands:**
```bash
# Create machine via UI:
# - Name: "Test Single Vuln"
# - Domain: Web Security
# - Modules: SQL Injection (75 points)

# Submit flag in Flags tab:
# FLAG{SQL_INJECTION_TEST}
```

---

### Test 2: Two Vulnerabilities Machine

**Setup:**
1. Create machine with 2 vulnerabilities (e.g., SQL Injection + XSS)
2. Deploy and open the lab

**Expected Behavior:**
- âœ… Vulnerability selector shows both vulnerabilities as tabs
- âœ… Can click between "sql injection" and "xss" tabs
- âœ… Active vulnerability highlighted with green border
- âœ… Submit flag for SQL Injection â†’ 1/2 captured
- âœ… Lab NOT marked as solved yet
- âœ… Report upload still LOCKED
- âœ… Switch to XSS tab and submit flag â†’ 2/2 captured
- âœ… Lab marked as SOLVED
- âœ… "Show Solutions" button appears
- âœ… Both vulnerabilities show checkmark (âœ“)
- âœ… Report upload UNLOCKED

**Test Commands:**
```bash
# Create machine via UI:
# - Name: "Test Multi Vuln"
# - Domain: Web Security
# - Modules: SQL Injection (75pts) + XSS (65pts)

# Step 1: Select "SQL Injection" tab, submit flag
# Step 2: Verify 1/2 shown in progress bar
# Step 3: Select "XSS" tab, submit flag
# Step 4: Verify 2/2 captured, banner shows, solutions available
```

---

### Test 3: Three+ Vulnerabilities Machine

**Setup:**
1. Create machine with 3+ vulnerabilities (e.g., SQL Injection + XSS + CSRF)
2. Deploy and open the lab

**Expected Behavior:**
- âœ… All 3 vulnerabilities shown as separate tabs
- âœ… Can solve in ANY order
- âœ… Progress bar updates: 0/3 â†’ 1/3 â†’ 2/3 â†’ 3/3
- âœ… Each solved vulnerability gets checkmark
- âœ… Lab only marked solved after ALL 3 flags submitted
- âœ… Solutions show for all 3 vulnerabilities

**Test Commands:**
```bash
# Create machine via UI:
# - Name: "Test Complex Lab"
# - Domain: Web Security
# - Modules: SQL Injection + XSS + CSRF

# Solve in random order (e.g., CSRF â†’ SQL â†’ XSS)
# Verify each flag submission updates progress independently
```

---

### Test 4: Solved State Persistence

**Setup:**
1. Create and fully solve a multi-vulnerability machine
2. Close the lab page
3. Reopen the same lab

**Expected Behavior:**
- âœ… Progress bar shows X/X captured
- âœ… All vulnerability tabs show checkmarks (âœ“)
- âœ… Lab completion banner displays
- âœ… "Show Solutions" button visible
- âœ… Can click "Show Solutions" to view walkthrough
- âœ… Report upload is UNLOCKED
- âœ… Cannot re-submit same flags (already solved message)

---

### Test 5: Partial Solve Persistence

**Setup:**
1. Create machine with 3 vulnerabilities
2. Solve only 2 out of 3
3. Close and reopen lab

**Expected Behavior:**
- âœ… Progress shows 2/3
- âœ… Solved vulnerabilities have checkmarks
- âœ… Unsolved vulnerability has no checkmark
- âœ… Lab NOT marked as fully solved
- âœ… Report upload still LOCKED
- âœ… "Show Solutions" button NOT visible
- âœ… Can submit remaining flag to complete lab

---

### Test 6: Flag Validation Per Vulnerability

**Setup:**
1. Create machine with SQL Injection + XSS
2. Try submitting wrong flags

**Expected Behavior:**
- âœ… Wrong flag shows "Incorrect flag. Try again!"
- âœ… Flag for SQL Injection only works for SQL Injection vulnerability
- âœ… Cannot use XSS flag to solve SQL Injection
- âœ… Each vulnerability validates its own flag independently

---

### Test 7: Solution Content Verification

**Setup:**
1. Fully solve a machine with multiple vulnerabilities
2. Click "Show Solutions & Walkthrough"

**Expected Behavior:**
- âœ… Solutions section displays below lab header
- âœ… Each solved vulnerability shows separate solution card
- âœ… Each solution includes:
  - âœ… ğŸ¯ Objective section
  - âœ… ğŸ” Steps to Solve (numbered list)
  - âœ… ğŸ’¡ Key Concepts (bulleted list)
  - âœ… ğŸš© Flag display
- âœ… Can toggle solutions on/off
- âœ… Solutions persist when switching tabs

---

## ğŸ” Key UI Elements to Verify

### Vulnerability Selector (Multi-Vuln Only)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select Vulnerability to Solve:                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚âœ“ sql_injectionâ”‚ â”‚  xss        â”‚ â”‚  csrf     â”‚ â”‚
â”‚ â”‚   75pts      â”‚ â”‚  65pts      â”‚ â”‚  70pts    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Active Vulnerability Indicator (Flags Tab)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current Challenge: xss  âœ“ Already Solved       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Progress Bar
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vulnerabilities                                 â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2/3 Captured â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Lab Complete Banner
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‰ Lab Completed! All vulnerabilities captured. â”‚
â”‚    You can now upload your lab report.          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Solution Toggle
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        [ğŸ”½ Show Solutions & Walkthrough]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› Common Issues & Fixes

### Issue 1: Only One Vulnerability Visible
**Symptom:** Created machine with multiple modules, but only 1 shows up
**Fix:** Check that `machine.vulnerabilities` array is populated in backend
**Verify:** `GET /api/machines/:id` should return vulnerabilities array

### Issue 2: Flags Not Validating
**Symptom:** Correct flag shows as incorrect
**Fix:** Ensure moduleMetadata.json has correct flags for each module
**Verify:** Check server/modules/{domain}/{moduleId}/metadata.json

### Issue 3: Solutions Not Showing
**Symptom:** Lab fully solved but no solutions button
**Fix:** Check `solvedVulns.length === totalVulns` condition
**Verify:** Ensure all flags submitted and stats refreshed

### Issue 4: Report Upload Not Unlocking
**Symptom:** All flags captured but report upload still locked
**Fix:** Ensure `isFullySolved` calculation is correct
**Verify:** `solvedCount === totalVulns && totalVulns > 0`

---

## ğŸ“‹ Pre-Flight Checklist

Before testing, ensure:
- [x] Backend running on port 5000
- [x] Frontend running on port 3001
- [x] MongoDB connected
- [x] User authenticated
- [x] Docker available for machine deployment
- [x] Module metadata files exist with flags

---

## ğŸ¯ Success Criteria

### âœ… Multi-Vulnerability Access
- [ ] Can create machine with 1 vulnerability
- [ ] Can create machine with 2 vulnerabilities
- [ ] Can create machine with 3+ vulnerabilities
- [ ] All selected vulnerabilities are accessible

### âœ… Independent Flag Validation
- [ ] Each vulnerability has its own flag
- [ ] Flags validate independently
- [ ] Cannot use wrong flag for vulnerability
- [ ] No flag overwrites previous solves

### âœ… Lab Completion Logic
- [ ] Lab NOT solved with partial flags (1/2, 2/3, etc.)
- [ ] Lab ONLY solved when ALL flags submitted
- [ ] Report upload locked until fully solved
- [ ] Report upload unlocks after all flags

### âœ… Persistent State
- [ ] Solved vulnerabilities persist on page reload
- [ ] Partial progress persists
- [ ] Cannot re-submit same flag
- [ ] Solutions appear only when fully solved

### âœ… Solution Display
- [ ] Solutions show for all solved vulnerabilities
- [ ] Each solution has objective, steps, concepts, flag
- [ ] Solutions toggle on/off correctly
- [ ] Solutions match vulnerability types

---

## ğŸš€ Quick Test Script

```bash
# 1. Start services
cd /Users/ashwingajbhiye/Desktop/CyberForge/CyberForge
npm run server &
npm run dev &

# 2. Login to CyberForge
# Navigate to http://localhost:3001/login

# 3. Create test machine
# Go to Machine Builder
# Add 2+ vulnerabilities (e.g., SQL + XSS)
# Deploy machine

# 4. Test solving
# Open lab â†’ See vulnerability selector
# Select first vuln â†’ Submit flag
# Verify 1/N captured, report locked
# Select second vuln â†’ Submit flag
# Verify N/N captured, report unlocked
# Click "Show Solutions"

# 5. Test persistence
# Close tab
# Reopen lab
# Verify all solved vulns show checkmarks
# Verify solutions button available
```

---

## ğŸ“ Test Results Template

```
Test Date: _______________
Tester: _______________

[ ] Test 1: Single Vulnerability - PASS / FAIL
[ ] Test 2: Two Vulnerabilities - PASS / FAIL
[ ] Test 3: Three+ Vulnerabilities - PASS / FAIL
[ ] Test 4: Solved State Persistence - PASS / FAIL
[ ] Test 5: Partial Solve Persistence - PASS / FAIL
[ ] Test 6: Flag Validation - PASS / FAIL
[ ] Test 7: Solution Content - PASS / FAIL

Issues Found:
_______________________________________
_______________________________________
_______________________________________
```

---

## ğŸ“ Solution Coverage

All 18 vulnerability types have solutions:

**Web Security:**
- [x] SQL Injection
- [x] XSS
- [x] CSRF
- [x] File Upload
- [x] Auth Bypass

**Red Team:**
- [x] Weak SSH
- [x] Exposed Services
- [x] Privilege Escalation
- [x] Cron Jobs

**Blue Team:**
- [x] Log Analysis
- [x] Malware Detection
- [x] SIEM Alert

**Cloud Security:**
- [x] Public Bucket
- [x] IAM Policy
- [x] Environment Variables

**Forensics:**
- [x] Memory Dump
- [x] Disk Image
- [x] Hidden Files

---

## ğŸ”§ Debugging Commands

```bash
# Check machine data
curl -s http://localhost:5000/api/machines/:id | jq .

# Check user stats
curl -s http://localhost:5000/api/flags/stats -b cookies.txt | jq .

# Check solved vulnerabilities
mongo cyberforge --eval "db.users.find({}, {solvedVulnerabilities:1}).pretty()"

# Check machines collection
mongo cyberforge --eval "db.machines.find({}, {vulnerabilities:1}).pretty()"
```
